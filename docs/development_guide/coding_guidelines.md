# コーディングガイドライン

このドキュメントでは、TaskFlowプロジェクトのコーディング規約について説明します。

## 一般原則

-   **一貫性**: コード全体で一貫したスタイルを維持します。
-   **可読性**: 読みやすく、理解しやすいコードを記述します。
-   **保守性**: 保守しやすいように、コードをモジュール化し、適切に抽象化します。
-   **簡潔性**: 不要なコードや複雑なロジックを避け、簡潔なコードを記述します。

## コーディングスタイル

-   **ESLint + Prettier**: コードのスタイルと品質を維持するために、ESLintとPrettierを使用します。
    -   ESLintの設定ファイル: `.eslintrc.json`
    -   Prettierの設定ファイル: `.prettierrc`
-   **インデント**: スペース2つ
-   **命名規則**:
    -   変数、関数: `camelCase`
    -   コンポーネント: `PascalCase`
    -   定数: `UPPER_SNAKE_CASE`
    -   ファイル名: `kebab-case.tsx` (コンポーネント), `camelCase.ts` (その他)
-   **コメント**:
    -   複雑なロジックや理解しにくい部分には、コメントを記述します。
    -   JSDoc形式で関数やコンポーネントのドキュメントを記述します。

## ディレクトリ構造

```
taskflow/
├── app/                  # アプリケーションのメインコード
│   ├── api/              # APIルート
│   │   └── tasks/
│   │       └── [id]/
│   │           └── route.ts # 個別タスクの取得、更新、削除
│   │       └── route.ts     # タスク一覧の取得、作成
│   ├── globals.css       # グローバルCSS
│   └── page.tsx          # ホームページ (ダッシュボード)
├── components/           # 再利用可能なコンポーネント
│   ├── TaskCard.tsx      # タスクカードコンポーネント
│   ├── TaskForm.tsx      # タスクフォームコンポーネント
│   ├── TaskList.tsx      # タスクリストコンポーネント
│   └── providers.tsx     # React Queryプロバイダー
├── hooks/                # カスタムフック
│   └── useTasks.ts       # タスクデータ取得・操作フック
├── lib/                  # ユーティリティ関数、型定義など
│   ├── cosmosdb.ts       # Cosmos DBクライアント設定
│   ├── cosmosHelpers.ts  # Cosmos DB操作ヘルパー関数
│   ├── errorHandling.ts # エラーハンドリングユーティリティ
│   └── types.ts          # 型定義
├── tests/                # テスト関連ファイル
│   ├── e2e/              # E2Eテスト
│   └── unit/             # ユニットテスト
├── .env.local            # 環境変数設定ファイル (サンプル)
├── jest.config.js        # Jest設定ファイル
├── next.config.js        # Next.js設定ファイル
├── package.json          # プロジェクト依存関係、スクリプト定義
├── playwright.config.ts  # Playwright設定ファイル
├── setupTests.ts         # テストセットアップファイル
└── tsconfig.json         # TypeScript設定ファイル
```

-   **`app`**: アプリケーションのメインコードを格納します。
    -   **`api`**: APIルートを格納します。
    -   **`globals.css`**: グローバルCSSファイルを格納します。
    -   **`page.tsx`**: ホームページ (ダッシュボード) のコンポーネントを格納します。
-   **`components`**: 再利用可能なUIコンポーネントを格納します。
-   **`hooks`**: カスタムフックを格納します。
-   **`lib`**: ユーティリティ関数、型定義、定数など、アプリケーション全体で使用されるコードを格納します。
-   **`tests`**: テストコードを格納します。
    -   **`e2e`**: E2Eテストを格納します。
    -   **`unit`**: ユニットテストを格納します。

## 使用ライブラリ

-   **`Next.js`**: アプリケーションのフレームワーク
-   **`React`**: UIの構築
-   **`TypeScript`**: 静的型付け
-   **`Tailwind CSS`**: スタイリング
-   **`Shadcn/ui`**: UIコンポーネント
-   **`React Query`**: サーバー状態の管理
-   **`zod`**: バリデーション
-   **`@azure/cosmos`**: Cosmos DBクライアント
-   **`react-hook-form`**: フォームの状態管理
-   **`lucide-react`**: アイコン
-   **`Jest`**: テストフレームワーク
-   **`React Testing Library`**: Reactコンポーネントのテスト
-   **`Playwright`**: E2Eテスト

## TypeScript

-   厳格な型チェックを有効にします (`tsconfig.json` の `"strict": true`)。
-   型定義は `lib/types.ts` に記述します。
-   可能な限り `any` の使用を避けます。

## コーディングのベストプラクティス

-   **コンポーネント**:
    -   コンポーネントは小さく、単一の責任を持つように設計します。
    -   コンポーネントのpropsの型定義を記述します。
    -   UIの状態管理には、必要最小限のローカルステートを使用し、サーバー状態の管理にはReact Queryを使用します。
-   **フック**:
    -   再利用可能なロジックはカスタムフックに抽出します。
    -   フックの依存配列を適切に設定します。
-   **関数**:
    -   純粋関数を優先的に使用します。
    -   関数の引数と戻り値の型を明示的に記述します。
-   **非同期処理**:
    -   `async/await` を使用して、非同期処理を同期的に記述します。
    -   エラーハンドリングを適切に行います (例: `try/catch`)。
-   **エラーハンドリング**:
    -   `lib/errorHandling.ts` の `handleCosmosError` 関数を使用して、Cosmos DBのエラーを適切に処理します。
    -   エラーメッセージはユーザーフレンドリーなものにします。
-   **パフォーマンス**:
    -   不要な再レンダリングを避けるために、`React.memo` や `useMemo`, `useCallback` を適切に使用します。
    -   大きなリストをレンダリングする場合は、仮想化を検討します。
-   **セキュリティ**:
    -   ユーザー入力を適切にエスケープして、XSS攻撃を防ぎます。
    -   機密情報をクライアントサイドに保存しないようにします。

## コミットメッセージ

-   コミットメッセージは、変更内容を明確かつ簡潔に記述します。
-   以下の形式に従います:

```
<type>(<scope>): <subject>

<body>

<footer>
```

-   **type**: 必須。コミットのタイプを表します。
    -   `feat`: 新機能
    -   `fix`: バグ修正
    -   `docs`: ドキュメントの変更
    -   `style`: コードのスタイル変更 (フォーマット、セミコロンの追加など)
    -   `refactor`: リファクタリング
    -   `test`: テストの追加や修正
    -   `chore`: ビルドプロセスや補助ツールの変更
-   **scope**: オプション。変更の範囲を表します。
-   **subject**: 必須。変更内容の要約。
-   **body**: オプション。変更内容の詳細な説明。
-   **footer**: オプション。関連するIssueやPull Requestへの参照など。

例:

```
feat(TaskForm): add validation for due date

Adds zod schema to validate that the due date is not in the past.

Closes #12
```

## プルリクエスト

-   プルリクエストを作成する前に、ローカルでテストを実行し、コードが正常に動作することを確認します。
-   プルリクエストのタイトルと説明には、変更内容を明確に記述します。
-   関連するIssueがある場合は、プルリクエストの説明にIssue番号を記載します。
-   コードレビューを依頼し、フィードバックに基づいてコードを修正します。

